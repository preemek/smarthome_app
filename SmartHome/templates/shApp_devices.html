{% extends 'shApp_base_template.html' %}

{% block title %} SHA List of devices {% endblock %}

{% block body %} 
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
  <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="navbar-brand" href="{% url 'smart_home' %}"><i class="fa-solid fa-house-signal"></i> Smart Home</a>
        </li>
        <li class="nav-item">
          <a class="navbar-brand" href="{% url 'stats' %}"><i class="fa-solid fa-chart-line"></i>&nbsp;&nbsp;Charts and statistics</a>
        </li>
        <li class="nav-item">
          <a class="navbar-brand" href="{% url 'logs' %}"><i class="fa-solid fa-table-list"></i>&nbsp;&nbsp;Recent events</a>
        </li>  
      </ul>
      <ul class="navbar-nav mx-auto">
        <li class="nav-item">
          <h4><i class="fa-regular fa-rectangle-list"></i> List of devices</h4>
        </li>
      </ul>  
      {% if user.is_authenticated %}
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <form method="post" action="{% url 'logout' %}" > 
              {% csrf_token %} 
              <button class="btn btn-secondary" type="submit">Log&nbsp;out&nbsp;<i class="fa-solid fa-arrow-right-to-bracket"></i></button> 
          </form>
        </li>  
      </ul>
      {% endif %} 
    </div>
  </div>
</nav>
{% if devices|length > 0 %}
    <br>
    <h6>{{ user.username }} you have {{ devices|length }} 
        {% if devices|length == 1 %}
            device to manage.
        {% else %}
            devices to manage.
        {% endif %}
    </h6>
    <div data-bs-spy="scroll" data-bs-smooth-scroll="true" class="scrollspy-example bg-body-tertiary p-3 rounded-2" tabindex="0">
        <div class="container text-center">
            <div class="row align-items-start">
                <div class="col" style="text-align: left">
                    <p>Device name</p>
                </div>
                <div class="col" style="text-align: center">
                    <p>On / Off</p>
                </div>
                <div class="col" style="text-align: left">
                    <p>Device power in watts</p>                    
                </div>
                <div class="col"  style="text-align: left">
                    <p>Device description</p>
                </div>
                <div class="col">
                    <p>Edit</p>
                </div>
                <div class="col">
                    <p>Delete</p>
                </div>
                <div class="col">
                    <p>New</p>
                </div>
            </div>
            {% for device in devices %}
            <div class="row align-items-start">
                <div class="col" style="text-align: left">
                    {{ device.name }}
                </div>
                <div class="col" style="text-align: center">
                <form method="post" action="{% url 'device_OnOff' device.id %}" > 
                    {% csrf_token %}
                    {% if device.status == 0 %}
                        <button type="submit" style="border: none; background-color: #f8f9fa"><i class="fa-solid fa-power-off" style="color:black"></i></button>
                    {% else %}
                        <button type="submit" style="border: none; background-color: #f8f9fa"><i class="fa-solid fa-power-off" style="color:green"></i></button>
                    {% endif %}
                </form>
                </div>
                <div class="col" style="text-align: left">
                    {{ device.power_in_watts }}
                </div>
                <div class="col"  style="text-align: left">
                    {{ device.description }}
                </div>
                <div class="col">
                    <a href="{% url 'edit_device' device.id %}" title="Edit device {{ device.name }}" style="color: black"><i class="fa-solid fa-pen-to-square"></i></a>
                </div>
                <div class="col">
                    <a href="{% url 'delete_device' device.id %}" title="Delete device {{ device.name }}" style="color: black"><i class="fa-solid fa-trash-can"></i></a>
                </div>
                <div class="col">
                    <a href="{% url 'new_device' %}" title="Add new device" style="color: black"><i class="fa-solid fa-square-plus"></i></a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

{% else %}
    <h6>{{ user.username }} you have no devices to manage.</h6>
    <a href="{% url 'new_device' %}">Add new device</a>
{% endif %}
{% endblock %}